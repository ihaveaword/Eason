# 🎓 Eason v2.0 开发者速查表

## 🗺️ 快速导航地图

```
我要...                        打开这个文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📧 修改邮件发送逻辑            src/core/email_sender.py
📥 修改联系人采集              src/core/contact_fetcher.py
⚙️ 修改配置存储                src/core/config_manager.py
🎨 修改界面布局                src/ui/main_window.py
💅 修改界面样式                src/ui/styles.py
✅ 修改邮箱验证                src/utils/validators.py
📂 修改文件读写                src/utils/file_handler.py
```

## 🏗️ 添加新功能的标准流程

### 场景1: 添加后端功能（不涉及UI）

**例如: 添加"发送失败自动重试"**

```bash
步骤1: 创建或修改核心模块
      src/core/email_sender.py
      
步骤2: 添加新方法
      def retry_send(self, max_retries=3):
          # 重试逻辑
      
步骤3: 测试（不需要启动GUI）
      python -c "from src.core import EmailSender; ..."
```

### 场景2: 添加前端功能（涉及UI）

**例如: 添加"进度百分比显示"**

```bash
步骤1: 修改UI
      src/ui/main_window.py
      添加进度标签控件
      
步骤2: 无需改核心逻辑
      EmailSender 已经有 progress_signal
      
步骤3: 连接信号槽
      self.send_thread.progress_signal.connect(self.update_percent)
```

### 场景3: 添加完整新功能

**例如: 添加"HTML邮件模板"**

```bash
步骤1: 创建核心模块
      src/core/template_engine.py
      
      class TemplateEngine:
          def render(self, template, data):
              # HTML模板渲染逻辑
      
步骤2: 集成到发送器
      src/core/email_sender.py
      
      from .template_engine import TemplateEngine
      
      def _build_email(self, recipient):
          if self.cfg.get('use_template'):
              html = TemplateEngine().render(...)
              msg.add_alternative(html, subtype='html')
      
步骤3: 添加UI控件
      src/ui/main_window.py
      
      self.template_checkbox = QCheckBox("使用HTML模板")
      self.template_selector = QPushButton("选择模板")
      
步骤4: 测试
      python main.py
```

## 📦 模块依赖关系

```
┌─────────────────────────────────────────┐
│             main.py                     │  启动入口
└────────────────┬────────────────────────┘
                 │
         ┌───────▼────────┐
         │   src/ui/      │  界面层（依赖core）
         │  - main_window │
         │  - styles      │
         └───────┬────────┘
                 │
         ┌───────▼────────┐
         │   src/core/    │  核心层（独立）
         │  - sender      │
         │  - fetcher     │
         │  - config      │
         └───────┬────────┘
                 │
         ┌───────▼────────┐
         │  src/utils/    │  工具层（被core调用）
         │  - validators  │
         │  - file_handler│
         └────────────────┘
```

**依赖原则**:
- ✅ UI 可以导入 Core
- ✅ Core 可以导入 Utils  
- ❌ Core 不能导入 UI
- ❌ Utils 不能导入 Core

## 🎯 常见任务速查

### 任务1: 支持QQ邮箱

```python
# 只需修改1个地方: src/core/email_sender.py
smtp_servers = {
    '163.com': 'smtp.163.com',
    'qq.com': 'smtp.qq.com',      # 新增
    'gmail.com': 'smtp.gmail.com'  # 新增
}

# 然后在 __init__ 中:
domain = config['user'].split('@')[1]
self.smtp_server = smtp_servers.get(domain, 'smtp.163.com')
```

### 任务2: 添加发送日志

```python
# 创建新模块: src/core/logger.py
class EmailLogger:
    def log_send(self, email, status, timestamp):
        # 记录到文件或数据库
        
# 在 email_sender.py 中使用:
from .logger import EmailLogger
self.logger = EmailLogger()
self.logger.log_send(contact, 'success', time.time())
```

### 任务3: 添加发送统计

```python
# 创建新模块: src/core/statistics.py
class SendStatistics:
    def add_record(self, email, success):
        self.total += 1
        if success:
            self.success += 1
    
    def get_success_rate(self):
        return self.success / self.total
        
# 在 email_sender.py 中:
from .statistics import SendStatistics
self.stats = SendStatistics()
```

### 任务4: 导出Excel格式

```python
# 修改: src/utils/file_handler.py
# 添加新函数:
def export_contacts_excel(contacts, filepath):
    import openpyxl
    wb = openpyxl.Workbook()
    ws = wb.active
    # ... 导出逻辑
    
# 就这么简单，其他地方不用改！
```

## 🧪 测试技巧

### 快速测试单个模块

```bash
# 测试邮箱验证
python -c "from src.utils import validate_email; \
           print(validate_email('test@163.com'))"

# 测试文件读取
python -c "from src.utils import read_contacts; \
           print(read_contacts('contacts.txt'))"

# 测试配置管理
python -c "from src.core import ConfigManager; \
           cm = ConfigManager(); \
           cm.save_email_config('test@163.com', 'pwd'); \
           print(cm.load_email_config())"
```

## 🔧 开发工具推荐

### VS Code 配置

`.vscode/settings.json`:
```json
{
    "python.analysis.extraPaths": ["${workspaceFolder}"],
    "python.autoComplete.extraPaths": ["${workspaceFolder}"],
    "files.exclude": {
        "**/__pycache__": true,
        "**/*.pyc": true
    }
}
```

### Git 工作流

```bash
# 开发新功能
git checkout -b feature/html-template
# ... 开发 ...
git add src/core/template_engine.py
git commit -m "✨ 添加HTML模板支持"
git checkout main
git merge feature/html-template

# 修复Bug
git checkout -b fix/send-retry-bug
# ... 修复 ...
git commit -m "🐛 修复发送重试逻辑"
git merge fix/send-retry-bug
```

## 💡 最佳实践

### DO ✅

```python
# 1. 职责单一
class EmailSender:
    """只负责发送邮件"""
    
# 2. 函数简短
def send_email(self, recipient):
    """一个函数做一件事"""
    
# 3. 有意义的命名
def validate_email(email):  # ✅ 好
def check(e):               # ❌ 差

# 4. 添加文档字符串
def export_contacts(contacts: List[str], filepath: str):
    """
    导出联系人到文件
    
    Args:
        contacts: 联系人列表
        filepath: 保存路径
    """
```

### DON'T ❌

```python
# 1. 不要在一个模块做太多事
# ❌ 在 email_sender.py 里处理UI
# ✅ UI逻辑放在 main_window.py

# 2. 不要跨层依赖
# ❌ from src.ui import MainWindow  # 在core中
# ✅ from src.core import EmailSender  # 在ui中

# 3. 不要硬编码
smtp_server = 'smtp.163.com'  # ❌
smtp_server = config.get('smtp_server', 'smtp.163.com')  # ✅

# 4. 不要巨大的函数
def do_everything():  # ❌ 500行
    # ...
    
def do_one_thing():   # ✅ 20行
    # ...
```

## 📚 学习路径

### Level 1: 新手（1周）
- ✅ 理解模块结构
- ✅ 修改配置参数
- ✅ 修改UI文本和样式
- ✅ 添加简单验证规则

### Level 2: 进阶（1月）
- ✅ 添加新的邮箱提供商
- ✅ 创建新的工具函数
- ✅ 修改发送策略
- ✅ 添加新的UI控件

### Level 3: 高级（3月）
- ✅ 设计新的核心模块
- ✅ 重构现有功能
- ✅ 添加数据库支持
- ✅ 创建插件系统

## 🎁 代码片段库

### 添加新的信号

```python
# src/core/email_sender.py
class EmailSender(QThread):
    # 添加新信号
    batch_complete_signal = pyqtSignal(int)  # 批次完成
    
    def run(self):
        # 发送信号
        self.batch_complete_signal.emit(batch_num)
```

### 添加新的配置项

```python
# src/core/config_manager.py
def save_new_config(self, value):
    self.settings.setValue('new_config_key', value)

def load_new_config(self):
    return self.settings.value('new_config_key', default_value)
```

### 添加新的验证规则

```python
# src/utils/validators.py
def validate_phone(phone: str) -> bool:
    """验证手机号"""
    pattern = r'^1[3-9]\d{9}$'
    return bool(re.match(pattern, phone))
```

## 🚀 快速启动

```bash
# 开发模式（可看到详细日志）
python main.py

# 生产模式（隐藏终端）
pythonw main.py

# 调试模式
python -m pdb main.py
```

---

**💡 记住**: 模块化不是让代码变复杂，而是让复杂的代码变简单！

**🎯 核心思想**: 每次只关注一个小模块，像搭积木一样开发！
