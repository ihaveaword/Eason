# 🚀 Eason 版本发布流程

## 📋 目录结构说明

```
Eason/
├── dist/              ← 打包输出（.gitignore）
├── build/             ← 构建临时文件（.gitignore）
├── release/           ← 发布文件（.gitignore）
│   ├── v1.0.0/
│   │   ├── Eason-v1.0.0.dmg
│   │   ├── checksums.txt
│   │   └── RELEASE_NOTES.md
│   ├── v1.0.1/
│   └── README.md
├── scripts/           ← 工具脚本（提交到 git）
└── .gitignore         ← 已配置忽略大文件
```

---

## ✅ Git 管理策略

### 提交到 Git 的：
- ✅ 源代码
- ✅ 脚本
- ✅ 文档
- ✅ 配置模板

### 不提交到 Git 的（.gitignore）：
- ❌ `dist/` - 打包输出
- ❌ `build/` - 构建文件
- ❌ `release/` - 发布文件
- ❌ `*.dmg` - DMG 安装包
- ❌ `*.zip` - 压缩包
- ❌ `*.spec` - PyInstaller 配置

---

## 🎯 为什么不提交大文件到 Git？

### 问题：
1. **仓库体积膨胀** - 每次提交都会永久保存
2. **克隆速度慢** - 用户下载代码时很慢
3. **浪费存储** - GitHub 有大小限制
4. **版本控制无意义** - 二进制文件无法 diff

### 解决方案：
- ✅ 使用 **GitHub Release** 存储发布文件
- ✅ 仅提交源代码和构建脚本
- ✅ 用户可以选择下载源码或安装包

---

## 📦 完整发布流程

### 方法 1: 一键发布（推荐）⭐️

```bash
# 自动化整个流程
./scripts/release.sh 1.0.1

# 这会自动：
# 1. 清理旧文件
# 2. 打包应用
# 3. 创建 DMG
# 4. 生成校验和
# 5. 生成 Release Notes
```

### 方法 2: 手动分步执行

```bash
# 1. 打包应用
./scripts/build_app.sh

# 2. 创建 DMG
./scripts/create_dmg.sh 1.0.1

# 3. 查看发布文件
ls -lh release/v1.0.1/
```

---

## 📤 上传到 GitHub Release

### 步骤 1: 访问 Release 页面

```
https://github.com/你的用户名/Eason/releases/new
```

### 步骤 2: 填写信息

```
Tag version: v1.0.1
Release title: 🎉 Eason v1.0.1
```

### 步骤 3: 复制 Release Notes

```bash
cat release/v1.0.1/RELEASE_NOTES.md
```

将内容粘贴到 Description 框

### 步骤 4: 上传文件

拖入以下文件：
- `release/v1.0.1/Eason-v1.0.1.dmg` ⭐️
- `release/v1.0.1/checksums.txt`

### 步骤 5: 发布

点击 **Publish release**

---

## 🔄 版本迭代示例

### v1.0.0 → v1.0.1

```bash
# 1. 修改代码
vim email_assistant_gui.py

# 2. 测试
./scripts/run.sh

# 3. 发布新版本
./scripts/release.sh 1.0.1

# 4. 上传到 GitHub
# 访问 releases/new 并上传
```

### 目录变化

```
release/
├── v1.0.0/
│   └── Eason-v1.0.0.dmg (25 MB)
└── v1.0.1/
    └── Eason-v1.0.1.dmg (25 MB)
```

**Git 仓库大小**：不变！✅

---

## 📊 文件大小对比

| 场景 | 提交到 Git | 使用 Release |
|------|-----------|--------------|
| 仓库大小 | 每版本 +25 MB | 保持小体积 |
| 克隆速度 | 越来越慢 | 始终快速 |
| 存储成本 | 累积增长 | 按需下载 |
| 版本切换 | 困难 | 清晰 |

---

## 🔐 校验和验证

### 为什么需要校验和？

- ✅ 验证下载完整性
- ✅ 防止文件损坏
- ✅ 确认来源真实性

### 用户如何验证？

```bash
# 下载 DMG 和 checksums.txt

# 验证
shasum -a 256 Eason-v1.0.0.dmg
# 对比 checksums.txt 中的值
```

---

## 📝 版本号规范

采用 [语义化版本](https://semver.org/lang/zh-CN/)：

```
主版本号.次版本号.修订号

示例：
1.0.0 - 首次发布
1.0.1 - Bug 修复
1.1.0 - 新功能
2.0.0 - 重大变更
```

### 更新规则：

| 类型 | 版本号变化 | 示例 |
|------|-----------|------|
| 修复 Bug | 修订号 +1 | 1.0.0 → 1.0.1 |
| 新功能（兼容） | 次版本号 +1 | 1.0.0 → 1.1.0 |
| 破坏性变更 | 主版本号 +1 | 1.0.0 → 2.0.0 |

---

## 🛠️ 常用命令

### 查看所有版本

```bash
ls -lh release/
```

### 清理旧版本（可选）

```bash
# 只保留最新 3 个版本
cd release
ls -t | tail -n +4 | xargs rm -rf
```

### 查看某个版本的信息

```bash
cat release/v1.0.0/RELEASE_NOTES.md
cat release/v1.0.0/checksums.txt
```

### 测试 DMG

```bash
open release/v1.0.0/Eason-v1.0.0.dmg
```

---

## 📖 用户下载流程

### 1. 访问 Release 页面

```
https://github.com/你的用户名/Eason/releases
```

### 2. 选择版本

点击最新的 Release

### 3. 下载 DMG

点击 `Eason-v1.0.0.dmg` 下载

### 4. 安装

双击 DMG → 拖动到 Applications

---

## 🎨 Release Notes 模板

每个版本会自动生成 `RELEASE_NOTES.md`：

```markdown
# 🎉 Eason v1.0.1

发布日期: 2024-11-29

## ✨ 新功能
- 添加了 XXX 功能
- 改进了 YYY

## 🐛 Bug 修复
- 修复了 AAA 问题
- 解决了 BBB 错误

## 📦 下载
- [DMG 安装包](链接)

## 💻 系统要求
- macOS 10.14+
```

---

## 🔍 问题排查

### 问题 1: Git 仓库太大

```bash
# 检查仓库大小
du -sh .git

# 如果误提交了大文件，使用：
git filter-branch --tree-filter 'rm -rf release' HEAD
git push --force
```

### 问题 2: .gitignore 不生效

```bash
# 清除缓存
git rm -r --cached .
git add .
git commit -m "Update .gitignore"
```

### 问题 3: Release 文件丢失

```bash
# Release 文件仅在本地
# 如需备份，上传到云盘或 GitHub Release
```

---

## 💡 最佳实践

### 1. 本地保留最近版本

```bash
# 只保留最近 3 个版本
release/
├── v1.0.2/  ← 最新
├── v1.0.1/
└── v1.0.0/
```

### 2. GitHub Release 保留所有版本

让用户可以下载历史版本

### 3. 定期备份

```bash
# 备份到云盘
rsync -av release/ ~/Backup/Eason-releases/
```

### 4. 标签管理

```bash
# 为每个版本打 Git 标签
git tag -a v1.0.0 -m "Release v1.0.0"
git push origin v1.0.0
```

---

## 📊 发布清单

发布新版本前的检查项：

- [ ] 代码已测试
- [ ] 版本号已更新
- [ ] 运行 `./scripts/release.sh X.X.X`
- [ ] 检查 DMG 文件
- [ ] 验证校验和
- [ ] 查看 Release Notes
- [ ] 上传到 GitHub Release
- [ ] 测试下载链接
- [ ] 更新 README 中的版本号
- [ ] 通知用户更新

---

## 🎊 完成！

现在你有了：

✅ **清晰的目录结构** - 分离源码和发布文件  
✅ **自动化脚本** - 一键发布  
✅ **版本管理** - 每个版本独立保存  
✅ **Git 优化** - 仓库保持小体积  
✅ **专业流程** - 符合开源项目标准  

---

## 📞 需要帮助？

遇到问题查看：
- `cat scripts/release.sh` - 发布脚本
- `cat .gitignore` - 忽略规则
- `cat release/README.md` - Release 目录说明

**🚀 享受你的版本管理系统吧！**
